<div class="page">
  <header class="page-header">
    <h1 class="page-header-title">Pagos</h1>
    <p class="page-header-subtitle">
      Procesa pagos de clientes y controla la configuración de la pasarela.
    </p>
  </header>

  <section class="card">
    <header class="card-header">
      <h2 class="card-title">Estado de pagos</h2>
      <span class="status-pill" [class.on]="enabledConfig" [class.off]="!enabledConfig">
        {{ enabledConfig ? 'Pagos habilitados' : 'Pagos deshabilitados' }}
      </span>
    </header>
    <p class="page-header-subtitle">
      La configuración se consulta desde la API
      <code>/api/Payments/config</code>.
    </p>
    <div style="margin-top: 0.75rem">
      <button class="btn btn-primary btn-sm" type="button" (click)="enableConfig()">
        Habilitar
      </button>
      <button class="btn btn-secondary btn-sm" type="button" (click)="disableConfig()">
        Deshabilitar
      </button>
    </div>
  </section>

  <section class="card" style="margin-top: 1.25rem">
    <header class="card-header">
      <h2 class="card-title">Procesar pago</h2>
      <p class="page-header-subtitle">
        Completa los datos del pago y envía la solicitud al endpoint
        <code>/api/Payments</code>.
      </p>
    </header>

    <form class="form-grid" (ngSubmit)="processPayment()" #paymentForm="ngForm">
      <div class="form-field">
        <label for="amount">Monto</label>
        <input
          id="amount"
          type="number"
          name="amount"
          [(ngModel)]="amount"
          min="0"
          step="0.01"
          required
        />
      </div>

      <div class="form-field">
        <label for="currency">Moneda</label>
        <input
          id="currency"
          type="text"
          name="currency"
          [(ngModel)]="currency"
          maxlength="3"
          required
        />
      </div>

      <div class="form-field">
        <label for="customer">Cliente</label>
        <input
          id="customer"
          type="text"
          name="customerIdentifier"
          [(ngModel)]="customerIdentifier"
          required
        />
      </div>

      <div class="form-field">
        <label for="method">Método</label>
        <select
          id="method"
          name="method"
          [(ngModel)]="method"
          required
        >
          <option [ngValue]="PaymentMethod.PayPal">PayPal</option>
          <option [ngValue]="PaymentMethod.Yape">Yape</option>
          <option [ngValue]="PaymentMethod.Plin">Plin</option>
        </select>
      </div>

      <div class="form-field" style="align-self: end">
        <button
          class="btn btn-primary"
          type="submit"
          [disabled]="paymentForm.invalid"
        >
          Procesar pago
        </button>
      </div>
    </form>

    <div *ngIf="errorMessage" class="alert alert-error">
      {{ errorMessage }}
    </div>

    <div
      *ngIf="result"
      class="alert"
      [class.alert-success]="result?.success"
      [class.alert-error]="!result?.success"
    >
      <p>
        <strong>Éxito:</strong>
        {{ result?.success ? 'Sí' : 'No' }}
      </p>
      <p *ngIf="result?.transactionId">
        <strong>ID de transacción:</strong> {{ result?.transactionId }}
      </p>
      <p *ngIf="result?.errorMessage">
        <strong>Mensaje:</strong> {{ result?.errorMessage }}
      </p>
    </div>
  </section>
</div>
